{% extends 'base.html' %}
{% load static %}

{% block content %}
    <style>
    .product-container{
        margin-top: 40px;
        margin-left: 50px;
    }
    </style>

    <div class="container">
     <div class="row">
    <div class="col-md-12">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <a class="navbar-brand" href="#">Navbar</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                  <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only"></span></a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Features</a>
                  </li>

                  <li class="nav-item">
{#                    <a id="cart-item_count" class="nav-link" href="#">Cart(0)</a>#}
                      <button id="cart-item"  data-html="true" type="button" class="btn btn-secondary" data-container="body" data-toggle="popover" data-placement="bottom" data-content="Vivamus
                    sagittis lacus vel augue laoreet rutrum faucibus.">
                    Cart(0)
                      </button>
                  </li>

                  <li class="nav-item">
                    <a class="nav-link disabled" href="#">Disabled</a>
                  </li>
                </ul>
              </div>
        </nav>
      </div>
    </div>

    <div class="row" style="width: 1320px;">
        <div class="col-md-12">
            <form class="card card-sm">
                <div class="card-body row no-gytters align-items-center">
                    <div class="col">
                        <input type="search" name="item_name" placeholder="Search for Products" class="form-control form-control-borderless">
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-success">Search</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="row">
        {% for prod in prod_object %}
        <div class="col-md-3">
            <div class="card">
                <img src="{{ prod.image.url }}" class="card-img-top"  height="150">
                <div class="card-body">
                    <div id="nm{{ prod.id }}" class="card-title" prod_name="{{ prod.title }}">{{ prod.title }}</div>
                    <div id="price{{ prod.id }}" class="card-price">{{ prod.price }}</div>
                    <a  href="{% url 'display_product_details' prod.id %}" class="btn btn-warning">View</a>
                    <button id='{{ prod.id }}' class="btn atc btn-warning " >Add to cart</button>
                </div>
            </div>
        </div>
        {% endfor %}

    <div class="row">
        <div class="col-md-3 offset-md-4">

        <ul class="pagination">
            {% if page_object.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_object.previous_page_number }}">Previous</a>
                </li>
            {% endif %}

                 <li class="page-item active" >
                    <a class="page-link" href="?page={{ page_object.number }}">Current</a>
                </li>

            {% if prod_object.has_next %}
                  <li class="page-item">
                     <a class="page-link" href="?page={{ page_object.next_page_number }}">Next</a>
                </li>
            {% endif %}
        </ul>
        </div>

    </div>


    </div>

    </div>


<script type="text/javascript">
    if (localStorage.getItem('cart') == null){
        var cart= {};
    }
    else{
        cart = JSON.parse((localStorage.getItem('cart')))
    }

    $(document).on('click', '.atc', function (){
        let item_id = this.id.toString();

        {#if (cart[item_id] != undefined){#}
        {#    cart[item_id] = cart[item_id]+1;#}
        {#}#}
        {#else {#}
        {# cart[item_id] = 1;#}
        {#}#}

        if (cart[item_id] != undefined){
            quantity = cart[item_id][0]+1;
            cart[item_id][0] = quantity;
            cart[item_id][2] = cart[item_id][2]+parseFloat(document.getElementById("price"+item_id).innerHTML);

        }
        else {
         quantity = 1;
         item_name = document.getElementById("nm"+item_id).innerHTML;
         item_price = parseFloat(document.getElementById("price"+item_id).innerHTML);
         console.log("I am printing------"+item_price);
         cart[item_id] = [quantity, item_name,item_price];
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        {#let cart_item_count  = document.getElementById("cart-item");#}
        {#let cart_item_count  = document.getElementById("cart-item")#}
        {#cart_item_count.innerHTML = "Cart(" +Object.keys(cart).length +")";#}
    });

    let cart_item_count  = document.getElementById("cart-item");
        {#let cart_item_count  = document.getElementById("cart-item")#}
    cart_item_count.innerHTML = "Cart(" +Object.keys(cart).length +")";

    displayCart(cart);
    function displayCart(cart){
       let cartString = '';
       cartString = cartString + "<h6>This is your cart </h6>";
       let cartIndex = 1;
       for(var x in cart){

           if(document.getElementById("nm"+x) != null){
             var cart_item_name = document.getElementById("nm"+x).innerHTML;
            }

           {#cartString  = cartString +cartIndex+")"+ cart_item_name+" "+"Qty:"+cart[x]+"<br>";#}
           cartString  = cartString +cartIndex+")"+ cart_item_name+" "+"Qty:"+cart[x][0]+"<br>";
           cartIndex = cartIndex +1;
       }
       console.log("cart item------------"+localStorage.getItem('cart'))
       cartString = cartString + "<br>"+"<button id='checkout' class='btn btn-warning' ><a class='btn btn-warning'   href='{% url 'checkout_products' %}'>Checkout</a></button>";
       document.getElementById('cart-item').setAttribute('data-content',cartString);
       $('[data-toggle="popover"]').popover()
    }

</script>


{% endblock %}